<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Event — signUPsignIN</title>

  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/components.css" />

  <style>
    form {
      background: var(--surface);
      padding: 24px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      max-width: 600px;
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 16px;
      margin-bottom: 6px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 15px;
    }

    textarea {
      height: 80px;
      resize: vertical;
    }

    .button-row {
      margin-top: 24px;
      display: flex;
      gap: 12px;
    }

    .page-header {
      margin-bottom: 32px;
    }
  </style>
</head>

<body>

  <div id="navbar"></div>

  <main class="container">

    <section class="page-header">
      <h1>Create Event</h1>
      <p class="helper-text">Fill out the form below to create a new event.</p>
    </section>

    <form id="createEventForm">

      <label for="title">Event Title</label>
      <input type="text" id="title" required placeholder="Example: Concession Volunteering Night" />

      <label for="description">Description (optional)</label>
      <textarea id="description" placeholder="Details about the event..."></textarea>

      <label for="start_time">Start Time</label>
      <input type="datetime-local" id="start_time" required />

      <label for="end_time">End Time</label>
      <input type="datetime-local" id="end_time" required />

      <label for="location">Location (optional)</label>
      <input type="text" id="location" placeholder="Gym, cafeteria, field, etc." />

      <div class="button-row">
        <button type="submit" class="btn btn-primary">Create Event</button>
        <a href="events.html" class="btn btn-light">Cancel</a>
      </div>

      <p id="statusMessage" class="helper-text" style="margin-top: 16px;"></p>

    </form>

  </main>

  <script type="module">
  import { requireAuth } from "../js/admin/utils/auth.js";
  await requireAuth();
</script>

  <script type="module">
    import { supabase } from "../js/supabaseClient.js";
    import { loadNavbar } from "../js/components/navbar.js";

    loadNavbar();

    const form = document.getElementById("createEventForm");
    const statusMessage = document.getElementById("statusMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusMessage.textContent = "Creating event…";

      const title = document.getElementById("title").value.trim();
      const description = document.getElementById("description").value.trim();
      const start = document.getElementById("start_time").value;
      const end = document.getElementById("end_time").value;
      const location = document.getElementById("location").value.trim();

      if (!title || !start || !end) {
        statusMessage.textContent = "Please fill out required fields.";
        return;
      }

      const { data, error } = await supabase
        .from("events")
        .insert({
          title,
          description,
          start_time: start,
          end_time: end,
          location
        })
        .select()
        .single();

      if (error) {
        console.error(error);
        statusMessage.textContent = "Error creating event. Please try again.";
        return;
      }

      statusMessage.textContent = "Event created successfully! Redirecting…";

      setTimeout(() => {
        window.location.href = "events.html";
      }, 800);
    });
  </script>

</body>
</html>

