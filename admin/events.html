<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin — Events | signUPsignIN</title>

  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/components.css" />

  <style>
    .admin-header {
      margin-bottom: 32px;
    }
    .admin-header h1 {
      margin-bottom: 8px;
    }
    .event-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <div id="navbar"></div>

  <main class="container">

    <section class="admin-header">
      <h1>Manage Events</h1>
      <p class="helper-text">View, edit, or delete existing events.</p>
      <br> <br>
      <a class="btn btn-primary" href="create.html">+ Create Event</a>
    </section>

    <section id="eventList"></section>

  </main>

  <script type="module">
  import { requireAuth } from "../js/admin/utils/auth.js";
  await requireAuth();
</script>

  <script type="module">
    import { supabase } from "../js/supabaseClient.js";
    import { loadNavbar } from "../js/components/navbar.js";

    loadNavbar();

    const listEl = document.getElementById("eventList");

    document.addEventListener("DOMContentLoaded", loadEvents);

    async function loadEvents() {
      listEl.innerHTML = "<p>Loading events…</p>";

      const { data, error } = await supabase
        .from("events")
        .select("*")
        .order("start_time", { ascending: true });

      if (error) {
        console.error(error);
        listEl.innerHTML = "<p>Error loading events.</p>";
        return;
      }

      if (!data.length) {
        listEl.innerHTML = `
          <div class="card">
            <h3>No Events Found</h3>
            <p>You haven't created any events yet.</p>
          </div>
        `;
        return;
      }

      listEl.innerHTML = data.map(renderEventCard).join("");
      attachDeleteHandlers();
    }

    function renderEventCard(event) {
  const date = new Date(event.start_time).toLocaleString([], {
    weekday: "long",
    month: "long",
    day: "numeric",
    hour: "numeric",
    minute: "2-digit"
  });

  return `
    <article class="card">
      <h2>${event.title}</h2>
      <p class="event-date">${date}</p>

      <div class="event-actions">
        <a
          href="/signupsigninv2/admin/event-details.html?id=${event.id}"
          class="btn btn-secondary"
        >
          Edit Details
        </a>

        <a
          href="/signupsigninv2/admin/edit-event.html?id=${event.id}"
          class="btn btn-secondary"
        >
          Manage Slots
        </a>

        <button
          class="btn btn-danger delete-btn"
          data-id="${event.id}"
        >
          Delete
        </button>
      </div>
    </article>
  `;
}

    function attachDeleteHandlers() {
      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
          const id = btn.dataset.id;

          if (!confirm("Are you sure you want to delete this event?")) {
            return;
          }

          const { error } = await supabase
            .from("events")
            .delete()
            .eq("id", id);

          if (error) {
            alert("Error deleting event.");
            console.error(error);
            return;
          }

          loadEvents(); // Refresh list
        });
      });
    }
  </script>

</body>
</html>





